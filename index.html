<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Forklift Intelligence Platform</title>
<style>
  body { font-family: Arial, sans-serif; line-height: 1.35; padding: 12px; }
  select, input { padding: 6px; min-width: 260px; }
  button { padding: 8px 12px; cursor: pointer; }
  .card { margin-top: 12px; padding: 12px; border: 1px solid #ccc; border-radius: 8px; }
  .muted { color: #666; font-size: 13px; }
  .row { margin: 8px 0; }
</style>
</head>
<body>

<h2>Forklift Year Decoder</h2>

<div class="row">
  <label>Manufacturer:</label>
  <select id="manufacturer"></select>
</div>

<div class="row">
  <label>Model:</label>
  <select id="model_select"></select>
</div>

<div class="row">
  <label>Serial:</label>
  <input type="text" id="serial" placeholder="Enter forklift serial">
</div>

<button id="btn">Decode Forklift Year</button>
<div id="result"></div>

<hr style="margin:40px 0;">

<h2>Battery Date Decoder</h2>

<div class="row">
  <label>Battery Manufacturer:</label>
  <select id="battery_manufacturer"></select>
</div>

<div class="row">
  <label>Battery Serial:</label>
  <input type="text" id="battery_serial">
</div>

<button id="battery_date_btn">Decode Battery Date</button>
<div id="battery_date_result"></div>

<hr style="margin:40px 0;">

<h2>Battery Size Detector</h2>

<div class="row">
  <label>Forklift Manufacturer:</label>
  <select id="battery_forklift_manufacturer"></select>
</div>

<div class="row">
  <label>Forklift Model:</label>
  <input type="text" id="battery_model">
</div>

<button id="battery_size_btn">Detect Battery Size</button>
<div id="battery_size_result"></div>

<hr style="margin:40px 0;">

<h2>Charger Selector</h2>

<div class="row">
  <label>Exact Battery AH:</label>
  <input type="number" id="charger_ah_exact">
</div>

<div class="row">
  <label>Chemistry:</label>
  <select id="charger_chemistry">
    <option value="Flooded">Flooded</option>
    <option value="AGM">AGM</option>
    <option value="TPPL">TPPL</option>
    <option value="Lithium">Lithium</option>
  </select>
</div>

<div class="row">
  <label>Usage:</label>
  <select id="charger_usage">
    <option value="Conventional">Conventional</option>
    <option value="Multi-shift">Multi-shift</option>
    <option value="Opportunity">Opportunity</option>
    <option value="Fast">Fast</option>
  </select>
</div>

<button id="charger_btn">Determine Charger</button>
<div id="charger_result"></div>

<script>
document.addEventListener("DOMContentLoaded", function(){

const ANON_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFvbGV5enJoZXhrZGRyeWZ4em56Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1OTg3NDQsImV4cCI6MjA4NzE3NDc0NH0.vYwvjNDE6Gistzk-5k2DDXIxmfr8wrnyXkvhMB0Ciuk";

const ENDPOINT_DECODE    = "https://qoleyzrhexkddryfxznz.supabase.co/rest/v1/rpc/decode_forklift";
const ENDPOINT_MODELS    = "https://qoleyzrhexkddryfxznz.supabase.co/rest/v1/rpc/get_models";
const ENDPOINT_BATT_DATE = "https://qoleyzrhexkddryfxznz.supabase.co/rest/v1/rpc/decode_battery";
const ENDPOINT_BATT_SIZE = "https://qoleyzrhexkddryfxznz.supabase.co/rest/v1/rpc/detect_battery_size";
const ENDPOINT_BATT_MFGS = "https://qoleyzrhexkddryfxznz.supabase.co/rest/v1/rpc/get_battery_manufacturers";
const ENDPOINT_CHARGER   = "https://qoleyzrhexkddryfxznz.supabase.co/rest/v1/rpc/calculate_charger";

function el(id){ return document.getElementById(id); }
function headers(){
  return {
    "Content-Type":"application/json",
    "apikey":ANON_KEY,
    "Authorization":"Bearer " + ANON_KEY
  };
}

/* MANUFACTURER LIST */
const MANUFACTURERS = [
  "Toyota","Hyster","Yale","Crown","Raymond",
  "Case","Allis-Chalmers","Aisle-Master",
  "Blue Giant","Bendi","Big Joe","Hyundai"
];

/* Populate dropdowns */
function populateManufacturers(){
  const mfg = el("manufacturer");
  const battFork = el("battery_forklift_manufacturer");

  mfg.innerHTML="";
  battFork.innerHTML="";

  MANUFACTURERS.forEach(name=>{
    const o1=document.createElement("option");
    o1.value=name; o1.text=name;
    mfg.appendChild(o1);

    const o2=document.createElement("option");
    o2.value=name; o2.text=name;
    battFork.appendChild(o2);
  });

  mfg.value="Toyota";
  battFork.value="Toyota";
}

/* LOAD MODELS */
async function loadModels(){
  const manufacturer = el("manufacturer").value;
  el("model_select").innerHTML="";

  const res = await fetch(ENDPOINT_MODELS,{
    method:"POST",
    headers:headers(),
    body:JSON.stringify({ manufacturer_input:manufacturer })
  });

  const data = await res.json();
  if(!res.ok || !Array.isArray(data)) return;

  data.forEach(m=>{
    const opt=document.createElement("option");
    opt.value=m;
    opt.text=m;
    el("model_select").appendChild(opt);
  });
}

/* LOAD BATTERY MFGS */
async function loadBatteryManufacturers(){
  el("battery_manufacturer").innerHTML="";
  const res = await fetch(ENDPOINT_BATT_MFGS,{
    method:"POST",
    headers:headers(),
    body:JSON.stringify({})
  });
  const data = await res.json();
  if(!res.ok || !Array.isArray(data)) return;

  data.forEach(n=>{
    const opt=document.createElement("option");
    opt.value=n;
    opt.text=n;
    el("battery_manufacturer").appendChild(opt);
  });
}

/* EVENTS */
el("manufacturer").addEventListener("change", loadModels);

el("btn").addEventListener("click", async ()=>{
  const res = await fetch(ENDPOINT_DECODE,{
    method:"POST",
    headers:headers(),
    body:JSON.stringify({
      manufacturer_input:el("manufacturer").value,
      model_input:el("model_select").value,
      serial_input:el("serial").value.trim()
    })
  });
  const data = await res.json();
  el("result").innerHTML =
    "<div class='card'><b>Year:</b> " +
    (data.manufacture_year || "Unknown") +
    "</div>";
});

/* INIT */
populateManufacturers();
loadModels();
loadBatteryManufacturers();

});
</script>

</body>
</html>
